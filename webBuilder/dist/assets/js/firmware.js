"use strict";import{builder,createBreadCrumb,ApiService,alertMsg,headerIconsStatus,SweetAlertMsg,card,reloadPage}from"./scripts.js";async function iniciarFirmware(){document.title="Firmware & Settings | ESP32 Admin Tool v3",createBreadCrumb("Configuración del Firmware y Settings","Dispositivo","Firmware & Settings");var resp=await new ApiService("device/status").getApiData(),resp=(headerIconsStatus(resp.wifiStatus,resp.rssiStatus,resp.mqttStatus),builder({type:"div",props:{class:"card-body"},children:[{type:"h5",props:{class:"card-title"},children:["Use este Botón para actualizar el Firmware o el FileSystem del Dispositivo."]},{type:"div",props:{class:"row mb-3"},children:[{type:"label",props:{class:"col-sm-12 col-form-label",for:"fileFirmware"},children:["Firmware & FileSystem"]},{type:"div",props:{class:"col-sm-12"},children:[{type:"input",props:{class:"form-control",type:"file",id:"fileFirmware",accept:"application/octet-stream"},children:[]}]},{type:"h6",props:{class:"text-secondary mt-3"},children:[{type:"strong",props:{},children:["Nota: Si el nombre de archivo incluye (spiffs), actualiza la partición del FileSystem"]}]}]},{type:"button",props:{class:"btn btn-danger",onclick:()=>{uploadFirmware()}},children:[{type:"i",props:{class:"bi bi-box-arrow-in-down me-1"},children:[]},"Importar"]},{type:"div",props:{class:"firmwareLoading",style:"display: none"},children:[{type:"h5",props:{class:"card-title mt-2"},children:["Cargando"]},{type:"div",props:{class:"progress"},children:[{type:"div",props:{class:"progress-bar progress-bar-striped bg-secondary progress-bar-animated",style:"width: 100%"},children:["100"]}]}]}]})),inputsSettings=builder({type:"div",props:{class:"card-body"},children:[{type:"h5",props:{class:"card-title"},children:["Archivo de configuraciones (setting.json)."]},{type:"div",props:{class:"row mb-3"},children:[{type:"label",props:{class:"col-sm-12 col-form-label",for:"fileSettings"},children:["Subir el archivo de configuración (settings.json)"]},{type:"div",props:{class:"col-sm-12"},children:[{type:"input",props:{class:"form-control",type:"file",id:"fileSettings",accept:"application/json"},children:[]}]}]},{type:"button",props:{class:"btn btn-success",onclick:()=>{uploadSettings()}},children:[{type:"i",props:{class:"bi bi-cloud-arrow-up-fill me-1"},children:[]},"Importar"]},{type:"label",props:{class:"col-sm-12 col-form-label mt-3",for:"fileFirmware"},children:["Descargar archivo de onfiguración (settings.json)"]},{type:"h6",props:{class:"text-secondary"},children:[{type:"strong",props:{},children:["Nota: Use este Botón para exportar las configuraciones actuales"]}]},{type:"button",props:{class:"btn btn-secondary",onclick:()=>{settingDonwload()}},children:[{type:"i",props:{class:"bi bi-cloud-download-fill me-1"},children:[]},"Descargar"]}]}),resp=builder({type:"section",props:{class:"section"},children:[{type:"div",props:{class:"row"},children:[{type:"div",props:{class:"col-lg-6"},children:[new card("Firmware o Filesystem",resp).buildCard()]},{type:"div",props:{class:"col-lg-6"},children:[new card("Archivo de configuración (setting.json)",inputsSettings).buildCard()]}]}]});document.querySelector("#main").appendChild(resp),localStorage.getItem("save")&&alertMsg("danger","¡Se han realizado cambios en la configuración, es necesario reiniciar el equipo!");const uploadFirmware=async()=>{var div,file=document.getElementById("fileFirmware").files[0];null==file?SweetAlertMsg("top-end","warning","¡Debes seleccionar un archivo( *.BIN )!",5e3):1966080<Number(file.size)?SweetAlertMsg("top-end","error","¡El tamaño máximo del archivo tiene que ser de ( 1.9 MB )!",5e3):"application/octet-stream"!=file.type?SweetAlertMsg("top-end","error","¡Solo son permitidos archivos ( *.BIN )!",5e3):((div=document.querySelector(".firmwareLoading")).style.cssText="display:block;",(file=await new ApiService("device/firmware",file).postFirmware()).save&&SweetAlertMsg("top-end","success",`¡${file.type} actualizado correctamente!`,5e3),div.style.cssText="display:none;",reloadPage("",1e4))},settingDonwload=async()=>{var resp=await new ApiService("device/download").getApiData();downloadObjectAsJson(resp,"settings.json")},downloadObjectAsJson=(exportObj,filename)=>{var exportObj=new Blob([JSON.stringify(exportObj)],{type:"text/json"}),link=document.createElement("a"),filename=(link.download=filename,link.href=window.URL.createObjectURL(exportObj),link.dataset.downloadurl=["text/json",link.download,link.href].join(":"),new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}));link.dispatchEvent(filename),link.remove()},uploadSettings=async()=>{var file=document.getElementById("fileSettings").files[0];null==file?SweetAlertMsg("top-end","warning","¡Debes seleccionar un archivo ( *.JSON )!",5e3):"settings.json"!=file.name?SweetAlertMsg("top-end","error","¡Solo se permite el archivo de configuración ( settings.json )!",5e3):14336<Number(file.size)?SweetAlertMsg("top-end","error","¡El tamaño máximo permitido es de ( 14.0 KB )!",5e3):"application/json"!=file.type?SweetAlertMsg("top-end","error","¡Solo son permitidos archivos ( *.JSON )!",5e3):(file=await new ApiService("device/upload",file).postFileApi(),console.log(file),file.save&&(SweetAlertMsg("top-end","success",""+file.msg,5e3),reloadPage("",1e4)))}}export{iniciarFirmware};